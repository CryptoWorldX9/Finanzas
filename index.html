<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuantyA | M谩s Control. Menos preocupaci贸n</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        /* Variables y Estilos de Estructura basados en la imagen */
        :root { 
            --p: #1e293b; 
            --sidebar-bg: #222f3e; 
            --acc: #2563eb; 
            --bg: #f1f5f9; 
            --danger: #ef4444; 
            --success: #10b981; 
        }
        * { margin:0; padding:0; box-sizing:border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); display: flex; min-height: 100vh; color: #334155; overflow-x: hidden; }

        /* BARRA LATERAL (Sin imagen de logo) */
        .sidebar { width: 260px; background: var(--sidebar-bg); color: white; padding: 35px 20px; position: fixed; height: 100vh; z-index: 1000; transition: 0.4s; }
        .logo-container { margin-bottom: 10px; padding-left: 10px; }
        .logo-container h1 { font-size: 28px; font-weight: 800; letter-spacing: -1px; color: white; }
        .slogan { font-size: 11px; color: #94a3b8; font-weight: 500; margin-bottom: 40px; display: block; padding-left: 10px; }
        
        .nav-link { display: flex; align-items: center; gap: 12px; padding: 12px 15px; color: #94a3b8; cursor: pointer; border-radius: 10px; margin-bottom: 5px; font-size: 14px; transition: 0.3s; }
        .nav-link:hover { background: rgba(255,255,255,0.05); color: white; }
        .nav-link.active { background: var(--acc); color: white; font-weight: 600; }

        /* CABECERA (Logo Agrandado) */
        .top-bar { 
            position: fixed; top: 0; left: 260px; right: 0; height: 100px; 
            background: white; display: flex; align-items: center; padding: 0 40px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05); z-index: 900; gap: 20px; transition: 0.4s;
        }
        .header-logo-app { height: 75px; width: auto; object-fit: contain; } /* Logo m谩s grande */
        
        /* CONTENIDO PRINCIPAL */
        .main-content { margin-left: 260px; padding: 40px; width: calc(100% - 260px); margin-top: 100px; transition: 0.4s; }

        /* Balances en cabecera estilo Dashboard */
        .balance-card { display: flex; gap: 30px; margin-left: auto; }
        .bal-item { text-align: right; }
        .bal-item small { font-size: 11px; font-weight: 700; color: #94a3b8; text-transform: uppercase; display: block; margin-bottom: 4px; }
        .bal-item p { font-size: 18px; font-weight: 800; color: var(--p); }

        /* Estilos de tus componentes (Mantenidos de tu c贸digo base) */
        .card { background: white; border-radius: 16px; padding: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.02); margin-bottom: 25px; border: 1px solid #e2e8f0; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; }
        label { font-size: 11px; font-weight: 800; color: #64748b; text-transform: uppercase; margin-bottom: 5px; display: block; }
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 10px; font-size: 14px; }
        .btn-p { background: var(--acc); color: white; border: none; padding: 12px 20px; border-radius: 10px; cursor: pointer; font-weight: 700; transition: 0.2s; }
        
        /* Pantalla de Auth (Mantenida de tu c贸digo) */
        #auth-screen { position: fixed; inset: 0; background: var(--p); z-index: 2000; display: flex; align-items: center; justify-content: center; color: white; }
        .auth-card { background: white; padding: 40px; border-radius: 20px; width: 100%; max-width: 400px; color: #1e293b; text-align: center; }

        /* Tablas y otros */
        .table-wrap { overflow-x: auto; margin-top: 15px; border-radius: 12px; }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 15px; background: #f8fafc; font-size: 11px; color: #64748b; }
        td { padding: 15px; border-bottom: 1px solid #f1f5f9; font-size: 13px; }

        @media (max-width: 900px) {
            .sidebar { left: -100%; }
            .top-bar { left: 0; padding: 0 20px; }
            .main-content { margin-left: 0; padding: 20px; }
            .balance-card { gap: 10px; }
            .header-logo-app { height: 50px; }
        }
    </style>
</head>
<body>

<div id="auth-screen">
    <div class="auth-card">
        <img src="logofinanzas.PNG" alt="QuantyA" style="width: 80px; margin-bottom: 15px;">
        <h2>QuantyA</h2>
        <div class="auth-tabs" style="display:flex; gap:10px; margin: 20px 0; background:#f1f5f9; padding:5px; border-radius:10px;">
            <button class="auth-tab" id="tab-login" onclick="setAuthMode('login')" style="flex:1; border:none; padding:10px; cursor:pointer; border-radius:8px;">Ingresar</button>
            <button class="auth-tab" id="tab-register" onclick="setAuthMode('register')" style="flex:1; border:none; padding:10px; cursor:pointer; border-radius:8px;">Crear Cuenta</button>
        </div>
        <input type="email" id="auth-email" placeholder="Email" style="margin-bottom:10px;">
        <input type="password" id="auth-pass" placeholder="Contrase帽a" style="margin-bottom:20px;">
        <button class="btn-p" style="width:100%" id="auth-btn" onclick="handleAuth()">INGRESAR</button>
        <p id="auth-error" style="color:red; font-size:12px; margin-top:15px;"></p>
    </div>
</div>

<div class="top-bar">
    <img src="logofinanzas.PNG" alt="Logo" class="header-logo-app">
    <div class="balance-card">
        <div class="bal-item"><small>Ingresos</small><p style="color:var(--success)" id="total-ingresos">$0</p></div>
        <div class="bal-item"><small>Egresos</small><p style="color:var(--danger)" id="total-egresos">$0</p></div>
        <div class="bal-item"><small>Saldo</small><p id="total-saldo">$0</p></div>
    </div>
</div>

<nav class="sidebar" id="sidebar">
    <div class="logo-container">
        <h1>QuantyA</h1>
    </div>
    <span class="slogan">M谩s Control. Menos preocupaci贸n</span>

    <div class="nav-link active" onclick="showTab('registro')"> <span>Registro</span></div>
    <div class="nav-link" onclick="showTab('historial')"> <span>Historial</span></div>
    <div class="nav-link" onclick="showTab('analisis')"> <span>An谩lisis</span></div>
    <div class="nav-link" onclick="showTab('metas')"> <span>Metas</span></div>
    <div class="nav-link" onclick="showTab('ajustes')">锔 <span>Ajustes</span></div>
    
    <div style="position:absolute; bottom:30px; width:calc(100% - 40px);">
        <button onclick="logout()" style="background:none; border:none; color:#94a3b8; cursor:pointer; font-size:12px; font-weight:bold; letter-spacing:1px;"> CERRAR SESIN</button>
    </div>
</nav>

<main class="main-content">
    <div id="registro" class="tab-content">
        <div class="card">
            <h3 id="form-title">Nueva Operaci贸n</h3><br>
            <input type="hidden" id="edit-id">
            <div class="form-grid">
                <div><label>Fecha</label><input type="date" id="f_fecha"></div>
                <div><label>Tipo</label><select id="f_tipo"></select></div>
                <div><label>Monto ($)</label><input type="text" id="f_monto" oninput="formatInput(this); calcLogic()"></div>
                <div><label>Presupuesto ($)</label><input type="text" id="f_presupuesto" oninput="formatInput(this); calcLogic()"></div>
            </div>
            <div class="form-grid" style="margin-top:15px;">
                <div><label>Concepto</label><input type="text" id="f_concepto"></div>
                <div><label>Categor铆a</label><select id="f_cat"></select></div>
                <div><label>Proveedor</label><select id="f_proveedor"></select></div>
                <div style="display:flex; align-items:flex-end; gap:10px;">
                    <button class="btn-p" style="flex:2;" onclick="saveData()"> GUARDAR</button>
                    <button class="btn-p" style="flex:1; background:#64748b;" onclick="clearForm()">Ч</button>
                </div>
            </div>
            </div>

        <div class="card">
            <h3>Movimientos Recientes</h3>
            <div class="table-wrap">
                <table>
                    <thead><tr><th>Fecha</th><th>Concepto</th><th>Monto</th><th>Categor铆a</th><th>Estado</th><th>Acciones</th></tr></thead>
                    <tbody id="list_reg_table"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="historial" class="tab-content" style="display:none;">
        </div>
    
    <div id="analisis" class="tab-content" style="display:none;">
        <div class="form-grid" style="grid-template-columns: 1fr 1fr;">
            <div class="card"><h3>Distribuci贸n</h3><canvas id="chartDona"></canvas></div>
            <div class="card"><h3>Resumen de Impacto</h3><p id="ana-mes-total"></p></div>
        </div>
    </div>
    
    <div id="metas" class="tab-content" style="display:none;">
        <div id="metas-container"></div>
    </div>

    <div id="ajustes" class="tab-content" style="display:none;">
        </div>
</main>

<script>
    // PEGA AQU TODA TU CONFIGURACIN DE FIREBASE Y FUNCIONES (saveData, initData, etc.)
    // He mantenido la base para que solo rellenes los datos:
    
    const firebaseConfig = {
      apiKey: "AIzaSyCO6WXu9iZsyEUmNNxrE4oWToLYY8wl-y4",
      authDomain: "misfinanzaspro-d2f3f.firebaseapp.com",
      projectId: "misfinanzaspro-d2f3f",
      storageBucket: "misfinanzaspro-d2f3f.firebasestorage.app",
      messagingSenderId: "613366165036",
      appId: "1:613366165036:web:bebc72b38d39ab64932b89"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    /* AQUI SIGUEN TODAS TUS FUNCIONES ORIGINALES (handleAuth, refreshUI, etc.) */
    /* No cambies nada de la l贸gica de negocio para que el sistema siga funcionando */
</script>

</body>
</html>
