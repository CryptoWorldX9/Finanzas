<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control Financiero Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary: #1e3c72;
            --secondary: #2a5298;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --bg: #f8fafc;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', system-ui, sans-serif; background: var(--bg); color: #334155; padding-bottom: 50px; }

        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }

        .header { 
            background: white; padding: 20px; border-radius: 15px; 
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); margin-bottom: 25px;
        }

        .btn { 
            padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer; 
            font-weight: 600; transition: all 0.2s; font-size: 14px;
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--success); color: white; width: 100%; margin-top: 10px; }
        .btn-danger { background: var(--danger); color: white; padding: 5px 10px; font-size: 12px; }

        .tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab-btn { 
            background: #e2e8f0; border: none; padding: 12px 25px; 
            border-radius: 10px; cursor: pointer; font-weight: 500;
        }
        .tab-btn.active { background: var(--primary); color: white; }

        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease; }

        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; }
        .form-group { display: flex; flex-direction: column; gap: 5px; }
        input, select { padding: 10px; border: 1px solid #cbd5e1; border-radius: 8px; outline: none; }

        .kpis { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .kpi-card { background: white; padding: 20px; border-radius: 15px; text-align: center; border-bottom: 4px solid var(--primary); }
        .kpi-value { font-size: 24px; font-weight: 800; margin: 10px 0; }

        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { background: #f1f5f9; padding: 12px; text-align: left; font-size: 12px; text-transform: uppercase; }
        td { padding: 12px; border-bottom: 1px solid #f1f5f9; font-size: 14px; }

        .badge { padding: 4px 8px; border-radius: 5px; font-size: 11px; font-weight: bold; }
        .bg-ingreso { background: #dcfce7; color: #166534; }
        .bg-egreso { background: #fee2e2; color: #991b1b; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h2>üí∞ Mi Control Financiero</h2>
        <button class="btn btn-primary" onclick="exportarExcel()">Descargar Reporte</button>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="cambiarTab(0)">Registro</button>
        <button class="tab-btn" onclick="cambiarTab(1)">Dashboard</button>
    </div>

    <div id="tab0" class="tab-content active">
        <div class="card">
            <h3>Nueva Transacci√≥n</h3><br>
            <div class="form-grid">
                <div class="form-group"><label>Fecha</label><input type="date" id="fecha"></div>
                <div class="form-group"><label>Concepto</label><input type="text" id="concepto" placeholder="Ej: Supermercado"></div>
                <div class="form-group">
                    <label>Tipo</label>
                    <select id="tipo">
                        <option value="Egreso">Egreso</option>
                        <option value="Ingreso">Ingreso</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Categor√≠a</label>
                    <select id="categoria">
                        <option value="Vivienda">Vivienda</option>
                        <option value="Alimentaci√≥n">Alimentaci√≥n</option>
                        <option value="Servicios">Servicios</option>
                        <option value="Ocio">Ocio</option>
                        <option value="Otros">Otros</option>
                    </select>
                </div>
                <div class="form-group"><label>Monto</label><input type="number" id="monto" placeholder="0.00"></div>
            </div>
            <button class="btn btn-success" onclick="agregarTransaccion()">Guardar Transacci√≥n</button>
        </div>

        <div class="card" style="margin-top: 20px; overflow-x: auto;">
            <h3>Historial Reciente</h3>
            <table id="tablaTransacciones">
                <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>Concepto</th>
                        <th>Tipo</th>
                        <th>Categor√≠a</th>
                        <th>Monto</th>
                        <th>Acci√≥n</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <div id="tab1" class="tab-content">
        <div class="kpis">
            <div class="kpi-card"><div>Saldo Actual</div><div class="kpi-value" id="kpiSaldo">$0</div></div>
            <div class="kpi-card"><div>Total Ingresos</div><div class="kpi-value" style="color: var(--success)" id="kpiIngresos">$0</div></div>
            <div class="kpi-card"><div>Total Gastos</div><div class="kpi-value" style="color: var(--danger)" id="kpiGastos">$0</div></div>
        </div>
        <div class="grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
            <div class="card"><h3>Gastos por Categor√≠a</h3><canvas id="chartCategorias"></canvas></div>
            <div class="card"><h3>Balance Mensual</h3><canvas id="chartBalance"></canvas></div>
        </div>
    </div>
</div>

<script>
    let transacciones = JSON.parse(localStorage.getItem('mis_gastos')) || [];
    let charts = {};

    document.getElementById('fecha').valueAsDate = new Date();

    function cambiarTab(idx) {
        document.querySelectorAll('.tab-content').forEach((c, i) => c.classList.toggle('active', i === idx));
        document.querySelectorAll('.tab-btn').forEach((b, i) => b.classList.toggle('active', i === idx));
        if(idx === 1) actualizarDashboard();
    }

    function agregarTransaccion() {
        const t = {
            id: Date.now(),
            fecha: document.getElementById('fecha').value,
            concepto: document.getElementById('concepto').value,
            tipo: document.getElementById('tipo').value,
            categoria: document.getElementById('categoria').value,
            monto: parseFloat(document.getElementById('monto').value) || 0
        };

        if(!t.concepto || t.monto <= 0) return alert("Datos inv√°lidos");

        transacciones.push(t);
        guardarYActualizar();
        document.getElementById('concepto').value = "";
        document.getElementById('monto').value = "";
    }

    function eliminar(id) {
        transacciones = transacciones.filter(t => t.id !== id);
        guardarYActualizar();
    }

    function guardarYActualizar() {
        localStorage.setItem('mis_gastos', JSON.stringify(transacciones));
        renderTabla();
    }

    function renderTabla() {
        const tbody = document.querySelector('#tablaTransacciones tbody');
        tbody.innerHTML = transacciones.map(t => `
            <tr>
                <td>${t.fecha}</td>
                <td>${t.concepto}</td>
                <td><span class="badge bg-${t.tipo.toLowerCase()}">${t.tipo}</span></td>
                <td>${t.categoria}</td>
                <td style="font-weight:bold">$${t.monto.toLocaleString()}</td>
                <td><button class="btn btn-danger" onclick="eliminar(${t.id})">‚úï</button></td>
            </tr>
        `).reverse().join('');
    }

    function actualizarDashboard() {
        const ingresos = transacciones.filter(t => t.tipo === 'Ingreso').reduce((s, t) => s + t.monto, 0);
        const gastos = transacciones.filter(t => t.tipo === 'Egreso').reduce((s, t) => s + t.monto, 0);
        
        document.getElementById('kpiSaldo').textContent = `$${(ingresos - gastos).toLocaleString()}`;
        document.getElementById('kpiIngresos').textContent = `$${ingresos.toLocaleString()}`;
        document.getElementById('kpiGastos').textContent = `$${gastos.toLocaleString()}`;

        renderCharts(ingresos, gastos);
    }

    function renderCharts(ing, gas) {
        if(charts.cat) charts.cat.destroy();
        if(charts.bal) charts.bal.destroy();

        const cats = {};
        transacciones.filter(t => t.tipo === 'Egreso').forEach(t => cats[t.categoria] = (cats[t.categoria] || 0) + t.monto);

        charts.cat = new Chart(document.getElementById('chartCategorias'), {
            type: 'doughnut',
            data: {
                labels: Object.keys(cats),
                datasets: [{ data: Object.values(cats), backgroundColor: ['#1e3c72', '#10b981', '#f59e0b', '#ef4444', '#64748b'] }]
            }
        });

        charts.bal = new Chart(document.getElementById('chartBalance'), {
            type: 'bar',
            data: {
                labels: ['Ingresos', 'Gastos'],
                datasets: [{ label: 'monto', data: [ing, gas], backgroundColor: ['#10b981', '#ef4444'] }]
            }
        });
    }

    function exportarExcel() {
        const ws = XLSX.utils.json_to_sheet(transacciones);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Gastos");
        XLSX.writeFile(wb, "Mis_Gastos.xlsx");
    }

    renderTabla();
</script>
</body>
</html>
